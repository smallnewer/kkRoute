var Route={};Route.dispatching=false;Route.route={};Route.history=[{path:"/",param:""}];Route.bind=function(a,b){a=a.toLowerCase();if(!this.route[a])this.route[a]={};this.route[a].active=false;this.route[a].handle=b};Route.forward=function(a,b){if(this.dispatching)return false;var c=typeof b;b="undefined"===c?"":b;if("string"!==typeof b)throw new Error("typeof param must be string");a=a.toLowerCase();a=a.replace(/\/+/g,"/");var d=this.getNowPath();if(a===d)return;this.history.push({path:a,param:b});this.dispatch(d,a,b)};Route.back=function(){if(this.dispatching)return false;var a=this.history[this.history.length-1];var b=this.getPrevPath();this.history.pop();this.dispatch(a.path,b,a.param)};Route.getNowPath=function(){return this.history[this.history.length-1].path};Route.getPrevPath=function(){return this.history[this.history.length-2].path};Route.get=function(a){var b=this.route;if(b&&b[a]&&b[a].handle)return this.route[a].handle;else return null};Route.onPreload=function(){};Route.onPreloadEnd=function(){};Route.dispatch=function(a,b,c){if(this.dispatching)return false;this.dispatching=true;var d=this.getCrossPath(a,b);var e=this;e.onPreload();e.execPreload(d.enter,c,function(a){e.onPreloadEnd();if(a){e.dispatching=false;console&&console.error("route dispatch error!",a);return}e.execEnter(d.enter,c,function(a){if(a){e.dispatching=false;console&&console.error("route dispatch error!",a);return}e.execLeave(d.leave,function(a){if(a){e.dispatching=false;console&&console.error("route dispatch error!",a);return}e.dispatching=false})})})};Route.execQueue=function(a,b,c,d,e){var f=0;var g=[];for(var h=0;h<a.length;h++){var i=this.route[a[h]];if(i&&i.handle&&i.handle[b]&&i.active===c)g.push(h)}if(g.length<=0)return d();for(var h=0;h<g.length;h++){var i=this.route[a[g[h]]];this.try(i.handle[b],i.handle,j,e);if("onPreload"!==b)i.active=!c}function j(a){if(a){d(a);return}f++;if(f>=g.length)d()}};Route.execLeave=function(a,b){this.execQueue(a,"onLeave",true,b)};Route.execEnter=function(a,b,c){this.execQueue(a,"onEnter",false,c,b)};Route.execPreload=function(a,b,c){this.execQueue(a,"onPreload",false,c,b)};Route.try=function(a,b,c,d){try{a.call(b,c,d)}catch(e){console&&console.warn("route.try get a error",e);c(e)}};Route.getParentPath=function(a){if("/"===a)return false;var b=a.split("/");if(b.length<=1)return"/";b.pop();return"/"+b.join("/")};Route.getParentPathArray=function(a){var b=[];var c=this.getParentPath(a);if(false===c)return b;b.push(c);var d=0;while("/"!==c){c=this.getParentPath(a);b.push(c);d++;if(d>20)break}return b};Route.getSplitPath=function(a){var b=["/"];if("/"===a)return b;var c=0;var d=a.indexOf("/",c);while(d>=0){var e=a.slice(0,d);if(e.length>0)b.push(e);c=d;d=a.indexOf("/",c+1)}b.push(a.slice(0));return b};Route.getCrossPath=function(a,b){var c={leave:[],enter:[]};if(a===b)return c;a=this.getSplitPath(a);b=this.getSplitPath(b);for(var d=0;d<a.length;)if(a[d]===b[d]){a.splice(d,1);b.splice(d,1);continue}else break;c.leave=a.reverse();c.enter=b;return c};